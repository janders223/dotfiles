* My dotfiles
[[https://builtwithnix.org][https://img.shields.io/badge/Built_With-Nix-5277C3.svg?logo=nixos&labelColor=73C3D5]]

  A collection of Darwin machine configurations - expressed in [[https://nixos.org/nix][Nix]] - leveraging [[https://github.com/LnL7/nix-darwin][LnL7/nix-darwin]] & [[https://github.com/rycee/home-manager][rycee/home-manager]] shamelessly ripped off from [[https://github.com/cmacrae/config][cmacrae]]

** Initial Install on macOS

In version 10.15 macOS disallows writing to ~/~, fortunately LnL7 was nice enough to wrap up the magic needed to create the needed directories in a bash script. Skip this step if running on an older version.

#+BEGIN_SRC shell
curl https://raw.githubusercontent.com/LnL7/nix/darwin-10.15-install/scripts/create-darwin-volume.sh | bash
#+END_SRC

Next, install the nix package manager

#+BEGIN_SRC shell
sh <(curl -L https://nixos.org/nix/install) --daemon
#+END_SRC

nix-darwin is the basis of this configuration

#+BEGIN_SRC shell
nix-build https://github.com/LnL7/nix-darwin/archive/master.tar.gz -A installer
#+END_SRC

And install it

#+BEGIN_SRC shell
./result/bin/darwin-installer
#+END_SRC

On the first run, we have to tell ~darwin-rebuild~ where to find the configuration for this machine. Subsequent runs can then just be called with ~darwin-rebuild switch~

#+BEGIN_SRC shell
darwin-rebuild switch -I darwin-config=~/path/to/config/machines/<HOSTNAME>/configuration.nix
#+END_SRC

Next, a logout would likely suffice, but we might as well just reboot

Another crucial piece of my config is emacs and more specifically [[github:hlissner/doom-emacs][doom]] emacs

#+BEGIN_SRC shell
git clone https://github.com/hlissner/doom-emacs ~/.emacs.d
#+END_SRC

My personal doom config is written in a [[wikipedia:Literate_programming][literate]] manner, tangle those now

#+BEGIN_SRC emacs-lisp
(org-babel-tangle-file "doom.org")
#+END_SRC

Finally, let doom download all dependencies

#+BEGIN_SRC shell
~/.emacs.d/bin/doom sync -e
#+END_SRC
